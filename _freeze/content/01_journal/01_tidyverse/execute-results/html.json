{
  "hash": "5fa8f43bb01f22a839c2ca8421cabac3",
  "result": {
    "markdown": "---\ntitle: \"Tidyverse\"\nauthor: \"Abou Househ, Ghazi\"\n---\n\n\n# Challenge: \n## Analyze the sales by location (state) and year with a bar plot.\n\n\n\n::: {.cell hash='01_tidyverse_cache/html/unnamed-chunk-1_e32c474db433651e62779fdeb0cdcbf7'}\n\n```{.r .cell-code}\n# 1.0 Load needed libraries ----\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#> ✔ dplyr     1.1.2     ✔ readr     2.1.4\n#> ✔ forcats   1.0.0     ✔ stringr   1.5.0\n#> ✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n#> ✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n#> ✔ purrr     1.0.1     \n#> ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#> ✖ dplyr::filter() masks stats::filter()\n#> ✖ dplyr::lag()    masks stats::lag()\n#> ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(readxl)\nlibrary(lubridate)\nlibrary(\"writexl\")\n# 2.0 Importing raw data from excel files ----\nbikes_tbl      <- read_excel(path = \"01_tidyverse_files/ds_data/ds_data/01_bike_sales/01_raw_data/bikes.xlsx\")\norderlines_tbl <- read_excel(\"01_tidyverse_files/ds_data/ds_data/01_bike_sales/01_raw_data/orderlines.xlsx\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> New names:\n#> • `` -> `...1`\n```\n:::\n\n```{.r .cell-code}\nbikeshops_tbl  <- read_excel(\"01_tidyverse_files/ds_data/ds_data/01_bike_sales/01_raw_data/bikeshops.xlsx\")\n\n# 3.0 Examining the raw data ----\n#orderlines_tbl\n#glimpse(orderlines_tbl)\n\n# 4.0 Joining the raw data ----\nbike_orderlines_joined_tbl <- orderlines_tbl %>% \n  left_join(bikes_tbl, by =c(\"product.id\"=\"bike.id\")) %>%\n  left_join(bikeshops_tbl, by =c(\"customer.id\"=\"bikeshop.id\"))\n\n\n# 5.0 Wrangling the raw data ----\n\nbike_state_wrangled_tbl <- bike_orderlines_joined_tbl%>%\n  separate(col=location,\n           into= c(\"city\",\"state\"),\n           sep= \",\")%>%\nmutate(total.price= price * quantity)%>%\nselect(-...1, -gender)%>%\n select(order.id,city,state,order.date, total.price, contains(\"model\"), contains(\"category\"),\n         price, quantity,\n         everything()) %>%\n  rename(bikeshop = name) %>%\n  set_names(names(.) %>% str_replace_all(\"\\\\.\", \"_\"))\n\n  \n\n# 6.0 Business Insights ----\n# 6.1 Sales by Location ----\n\n# Step 1 - Manipulate data\n\nstate_sales <- bike_state_wrangled_tbl%>%\n  select(state,total_price)%>%\n  group_by(state)%>%\n  summarize(sales=sum(total_price))%>%\n  mutate(sales_text = scales::dollar(sales, big.mark = \".\", \n                                     decimal.mark = \",\", \n                                     prefix = \"\", \n                                     suffix = \" €\"))\n# Step 2 - Visualize data\nstate_sales %>%\n  \n  # Setup canvas with the columns year (x-axis) and sales (y-axis)\n  ggplot(aes(x = state, y = sales)) +\n  \n  # Geometries\n  geom_col(fill = \"#00FF00\") + # Use geom_col for a bar plot\n  geom_label(aes(label = sales_text)) + # Adding labels to the bars\n  geom_smooth(method = \"lm\", se = FALSE) + # Adding a trendline\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))  + \n  # Formatting\n  scale_y_continuous(labels = scales::dollar_format(big.mark = \".\", \n                                                    decimal.mark = \",\", \n                                                    prefix = \"\", \n                                                    suffix = \" €\")) +\n  labs(\n    title    = \"Revenue by States\",\n    x = \"States\", # Override defaults for x and y\n    y = \"Revenues\"\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](01_tidyverse_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n\n### Which state has the highest revenue?\n\nIt can be clearly seen from the generated plot that **\"North Rhine-Westphalia\"** has the highest revenue.\n\n# Challenge\n\n## Analyze the sales by location and year. \n\n\n\n::: {.cell hash='01_tidyverse_cache/html/unnamed-chunk-2_c0a0edd2541e576967083ebdff47150d'}\n\n```{.r .cell-code}\n# 6.2 Sales by Location and Year----\n\n# Step 1 - Manipulate\nsales_by_location_year <- bike_state_wrangled_tbl %>%\n  \n  # Select columns and add a year\n  select(order_date, total_price,state) %>%\n  mutate(year = year(order_date)) %>%\n  \n  # Group by and summarize year and state\n  group_by(year,state) %>%\n  summarise(sales = sum(total_price)) %>%\n  ungroup() %>%\n  \n  # Format $ Text\n  mutate(sales_text = scales::dollar(sales, big.mark = \".\", \n                                     decimal.mark = \",\", \n                                     prefix = \"\", \n                                     suffix = \" €\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `summarise()` has grouped output by 'year'. You can override using the\n#> `.groups` argument.\n```\n:::\n\n```{.r .cell-code}\n# Step 2 - Visualize\nsales_by_location_year %>%\n  \n  # Set up x, y, fill\n  ggplot(aes(x = year, y = sales, fill = state)) +\n  \n  # Geometries\n  geom_col() + # Run up to here to get a stacked bar plot\n  \n  # Facet\n  facet_wrap(~ state) +\n  \n  # Formatting\n  scale_y_continuous(labels = scales::dollar_format(big.mark = \".\", \n                                                    decimal.mark = \",\", \n                                                    prefix = \"\", \n                                                    suffix = \" €\")) +\n  labs(\n    title = \"Revenue by Year and State\",\n    fill = \"Main category\" # Changes the legend name\n  )\n```\n\n::: {.cell-output-display}\n![](01_tidyverse_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}