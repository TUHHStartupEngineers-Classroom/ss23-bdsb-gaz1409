{
  "hash": "2b97efe67e1061ed8fa5c6ff5e1419fa",
  "result": {
    "markdown": "---\ntitle: \"Data Acquisition\"\nauthor: \"Abou Househ, Ghazi\"\n---\n\n\n# Challenge: \n## Get some data via an API.\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-1_4dbd66367a038849a36a63456f08d724'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\ninstall.packages(\"devtools\", repos = \"http://cran.rstudio.com/\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Installing package into 'C:/Users/ghazi/AppData/Local/R/win-library/4.3'\n#> (as 'lib' is unspecified)\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> package 'devtools' successfully unpacked and MD5 sums checked\n#> \n#> The downloaded binary packages are in\n#> \tC:\\Users\\ghazi\\AppData\\Local\\Temp\\Rtmp6Z0uRH\\downloaded_packages\n```\n:::\n\n```{.r .cell-code}\nlibrary(httr)\n\nurl <- \"http://api.positionstack.com/v1/forward\"\nquery <- list(\n  access_key = \"719078b5b097cb0a4a7a41efcb8d1e0b\",\n  query = \"Copacabana\",\n  region = \"Rio de Janeiro\",\n  limit = 1\n)\n\nresponse <- GET(url, query = query)\ndata <- content(response, \"text\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> No encoding supplied: defaulting to UTF-8.\n```\n:::\n\n```{.r .cell-code}\n# Parse JSON data\nparsed_data <- fromJSON(data, simplifyVector = FALSE)\n\n# Extract latitude and longitude\nlatitude <- parsed_data$data[[1]]$latitude\nlongitude <- parsed_data$data[[1]]$longitude\nknitr::kable(latitude, caption = 'Latitude')\n```\n\n::: {.cell-output-display}\nTable: Latitude\n\n|         x|\n|---------:|\n| -22.97648|\n:::\n\n```{.r .cell-code}\nknitr::kable(longitude, caption = 'Longitude')\n```\n\n::: {.cell-output-display}\nTable: Longitude\n\n|         x|\n|---------:|\n| -43.18768|\n:::\n:::\n\n# Challenge: \n## Scrape one of the competitor websites of canyon\n## I chose Rose Bikes\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-2_b8d4f1419886580c5a0c2a4edd7b670a'}\n\n```{.r .cell-code}\nlibrary(RSQLite)\nlibrary(tidyverse)\nlibrary(httr)\nlibrary(glue)\nlibrary(jsonlite)\nlibrary(rvest)\nlibrary(stringi)\nlibrary(xopen)\nlibrary(dplyr)\nbase_url <- 'https://www.rosebikes.com/bikes'\n# 1. A function to get bike family URLs.\nget_bike_family_urls <- function(base_url) {\n  \n  bike_family_urls <- read_html(base_url) %>%\n    html_nodes(css = \".catalog-categories-item > a\") %>%\n    html_attr('href') %>%\n    \n    # Convert vector to a tibble\n    \n    enframe(name = \"position\", value = \"subdirectory\") %>%\n    # Add the domain because we will get only the subdirectories\n    mutate(\n      url = glue('https://www.rosebikes.com{subdirectory}')\n    ) \n}\n# 2.A function to get the bike family URLs.\nget_model_urls <- function(url) {\n  \n  bike_type_url <- read_html(url) %>%\n    html_nodes(css = \".catalog-category-bikes__content > a\") %>%\n    html_attr('href') %>%\n    enframe(name = \"position\", value = \"url\") %>%\n    mutate(url = glue('https://www.rosebikes.com{url}')) \n}\n# 3.A function to get the names of each bike \nget_bike_names <- function(url) {\n  \n  bike_model_name_tbl <- read_html(url) %>%\n    html_nodes(css = \".catalog-category-model__title\") %>%\n    html_text() %>%\n    # Convert vector to a tibble\n    as_tibble()\n  \n  \n}\n# 4.A function to get the prices of each bike \nget_bike_prices <- function(url) {\n  \n  bike_model_price_tbl <- read_html(url) %>%\n    html_nodes(css = \".product-tile-price__current-value\") %>%\n    html_text() %>%\n    # Convert vector to tibble\n    as_tibble()\n  \n}\n#### APPLYING ABOVE FUNCTIONS\nbike_family_url_tbl <- get_bike_family_urls(base_url)\nbike_family_url_tbl <- bike_family_url_tbl %>%\n  slice(2:4) # Pick 3 categories\n# Create a table with bike model URLS\nbike_model_url_tbl <- tibble()\nfor (i in seq_along(bike_family_url_tbl$url)) {\n  \n  web <- toString(bike_family_url_tbl$url[i])\n  bike_model_url_tbl <- bind_rows(bike_model_url_tbl, get_model_urls(web))\n  \n}\n# Create a table with bike model names\nbike_model_names_tbl <- tibble()\nfor (i in seq_along(bike_model_url_tbl$url)) {\n  \n  web <- toString(bike_model_url_tbl$url[i])\n  bike_model_names_tbl <- bind_rows(bike_model_names_tbl, get_bike_names(web))\n  \n}\n# Rename cols\nnames(bike_model_names_tbl)[1] <- \"Bike Model\"\n# Create a table with bike prices\nbike_model_prices_tbl <- tibble()\nfor (i in seq_along(bike_model_url_tbl$url)) {\n  web <- toString(bike_model_url_tbl$url[i])\n  bike_model_prices_tbl <- bind_rows(bike_model_prices_tbl, get_bike_prices(web))\n}\n# Rename cols\nnames(bike_model_prices_tbl)[1] <- \"Bike Prices\"\n# Join into one table\ntable_of_prices <- bind_cols(bike_model_names_tbl,bike_model_prices_tbl)\nknitr::kable(table_of_prices[1:10, ], caption = 'Rosebikes.com bicycle prices')\n```\n\n::: {.cell-output-display}\nTable: Rosebikes.com bicycle prices\n\n|Bike Model              |Bike Prices |\n|:-----------------------|:-----------|\n|XLITE 04 105            |€2,999.00   |\n|XLITE 04 Ultegra        |€3,299.00   |\n|XLITE 04 105 Di2        |€3,599.00   |\n|XLITE 04 Ultegra Di2    |€4,599.00   |\n|XLITE 04 Force eTap AXS |€4,599.00   |\n|XLITE 04 Force AXS      |€4,999.00   |\n|XLITE 06 Ultegra        |€3,999.00   |\n|XLITE 06 Ultegra Di2    |€5,999.00   |\n|XLITE 06 Force eTap AXS |€5,999.00   |\n|XLITE 06 Force AXS      |€6,499.00   |\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}